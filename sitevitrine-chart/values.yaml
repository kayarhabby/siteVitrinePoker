# =============================================================
# SiteVitrine Helm Chart - OPTIMIZED VALUES
# =============================================================

# ----------------------------
# Application Spring Boot
# ----------------------------
app:
  name: sitevitrine-app
  image:
    repository: kayarhabby/sitevitrine-app
    tag: latest
    pullPolicy: Always
  replicas: 2
  port: 8080
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
      ephemeralStorage: 1Gi
    limits:
      cpu: 500m
      memory: 512Mi
      ephemeralStorage: 2Gi
  extraEnv: []

service:
  type: NodePort
  port: 80
  targetPort: 8080
  nodePort: 30080

# ----------------------------
# MySQL
# ----------------------------
mysql:
  name: sitevitrine-mysql
  image:
    repository: kayarhabby/sitevitrine-mysql
    tag: latest
    pullPolicy: Always
  database: siteVitrineDB
  port: 3306

  secret:
    name: mysql-secret
    rootPassword: sitepasswordroot
    user: siteuser
    password: sitepassword

  persistence:
    enabled: true
    storageClassName: ebs-gp3-sc
    size: 5Gi
    accessMode: ReadWriteOnce

  storageClass:
    create: true
    name: ebs-gp3-sc
    provisioner: ebs.csi.aws.com
    volumeBindingMode: WaitForFirstConsumer
    fstype: ext4
    type: gp3
    encrypted: "true"
    zone: us-east-1a

# ----------------------------
# Monitoring
# ----------------------------
monitoring:
  enabled: true
  namespace: monitoring

  serviceMonitor:
    enabled: true
    interval: 30s
    path: /actuator/prometheus

  prometheusRule:
    enabled: true

# ----------------------------
# kube-prometheus-stack
# ----------------------------
kube-prometheus-stack:
  fullnameOverride: prometheus

  nodeExporter:
    enabled: true
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi

  kubeStateMetrics:
    enabled: true

  kube-state-metrics:
    metricLabelsAllowlist:
      - pods=[app,release,version]
      - deployments=[app,release]
    resources:
      requests:
        memory: 64Mi
        cpu: 50m
      limits:
        memory: 256Mi
        cpu: 200m

  prometheus:
    prometheusSpec:
      scrapeInterval: 30s
      evaluationInterval: 30s

      retention: 7d
      retentionSize: "6GB"

      enableAdminAPI: true
      walCompression: true

      resources:
        requests:
          memory: 1Gi
          cpu: 500m
        limits:
          memory: 2Gi
          cpu: 1

      serviceMonitorSelectorNilUsesHelmValues: false
      serviceMonitorSelector: {}
      serviceMonitorNamespaceSelector: {}

      podMonitorSelectorNilUsesHelmValues: false
      podMonitorSelector: {}
      podMonitorNamespaceSelector: {}

      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: ebs-gp3-sc
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 10Gi

  kubelet:
    enabled: true
    serviceMonitor:
      cAdvisor: true

  kubeApiServer:
    enabled: true
  kubeProxy:
    enabled: true

  kubeEtcd:
    enabled: false
  kubeControllerManager:
    enabled: false
  kubeScheduler:
    enabled: false

  grafana:
    enabled: true
    adminPassword: "grafana-admin-password"

    resources:
      requests:
        memory: 256Mi
        cpu: 200m
      limits:
        memory: 512Mi
        cpu: 500m

    persistence:
      enabled: true
      storageClassName: ebs-gp3-sc
      size: 5Gi

    service:
      type: NodePort
      nodePort: 30300

    plugins:
      - grafana-piechart-panel
      - grafana-worldmap-panel

    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        folder: /var/lib/grafana/dashboards
      datasources:
        enabled: true
        label: grafana_datasource

    grafana.ini:
      server:
        root_url: "%(protocol)s://%(domain)s:%(http_port)s/"
      users:
        allow_sign_up: true
      dashboards:
        default_home_dashboard_path: ""
      database:
        wal: true

  alertmanager:
    enabled: true
    alertmanagerSpec:
      resources:
        requests:
          memory: 100Mi
        limits:
          memory: 256Mi